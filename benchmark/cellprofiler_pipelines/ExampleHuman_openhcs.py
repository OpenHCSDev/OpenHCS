"""
OpenHCS Pipeline - Converted from CellProfiler
Source: ExampleHuman.cppipe

Auto-generated by CellProfiler â†’ OpenHCS converter.
"""

import numpy as np
from typing import Tuple, List, Optional, Dict, Any
from dataclasses import dataclass
from enum import Enum

# OpenHCS imports
from openhcs.core.steps.function_step import FunctionStep
from openhcs.core.config import LazyProcessingConfig
from openhcs.constants.constants import VariableComponents, GroupBy
from openhcs.core.memory.decorators import numpy
from openhcs.processing.backends.lib_registry.unified_registry import ProcessingContract
from openhcs.core.pipeline.function_contracts import special_outputs
from openhcs.processing.materialization import csv_materializer

# Absorbed CellProfiler functions
from benchmark.cellprofiler_library import (
    identify_primary_objects,
    identify_secondary_objects,
    measure_object_intensity,
    measure_object_size_shape,
)

# Pipeline Steps
# Settings from .cppipe are bound as default parameters
# variable_components derived from LLM-inferred category
pipeline_steps = [
    FunctionStep(
        func=identify_primary_objects,
        name="IdentifyPrimaryObjects",
        processing_config=LazyProcessingConfig(
            variable_components=[VariableComponents.SITE]
        ),
        # Settings from .cppipe:
        # select_the_input_image='DNA'
        # name_the_primary_objects_to_be_identified='Nuclei'
        # typical_diameter_of_objects_in_pixel_units=(8, 80)
        # discard_objects_outside_the_diameter_range=True
        # discard_objects_touching_the_border_of_the_image=True
    ),
    FunctionStep(
        func=identify_secondary_objects,
        name="IdentifySecondaryObjects",
        processing_config=LazyProcessingConfig(
            variable_components=[VariableComponents.SITE]
        ),
        # Settings from .cppipe:
        # select_the_input_objects='Nuclei'
        # name_the_objects_to_be_identified='Cells'
        # select_the_method_to_identify_the_secondary_objects='Propagation'
        # select_the_input_image='cellbody'
        # number_of_pixels_by_which_to_expand_the_primary_objects=10
    ),
    FunctionStep(
        func=measure_object_intensity,
        name="MeasureObjectIntensity",
        processing_config=LazyProcessingConfig(
            variable_components=[VariableComponents.SITE]
        ),
        # Settings from .cppipe:
        # select_images_to_measure=['DNA', 'PH3']
        # select_objects_to_measure=['Nuclei', 'Cells', 'Cytoplasm']
    ),
    FunctionStep(
        func=measure_object_size_shape,
        name="MeasureObjectSizeShape",
        processing_config=LazyProcessingConfig(
            variable_components=[VariableComponents.SITE]
        ),
        # Settings from .cppipe:
        # select_object_sets_to_measure=['Nuclei', 'Cells', 'Cytoplasm']
        # calculate_the_zernike_features=True
        # calculate_the_advanced_features=False
    ),
]