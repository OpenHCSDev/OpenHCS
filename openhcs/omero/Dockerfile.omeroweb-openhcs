FROM openmicroscopy/omero-web-standalone:5

# Copy plugin source (as root)
USER root
COPY omero_openhcs /tmp/omero_openhcs

# Install plugin (as root is OK for pip)
RUN /opt/omero/web/venv3/bin/pip install /tmp/omero_openhcs

# Switch to omero-web user for omero config commands
USER omero-web

# Configure OMERO.web to load the plugin
RUN /opt/omero/web/venv3/bin/omero config append omero.web.apps '"omero_openhcs"'

# Add OpenHCS tab to right panel
RUN /opt/omero/web/venv3/bin/omero config append omero.web.ui.right_plugins \
    '["OpenHCS", "omero_openhcs/webclient_plugins/right_plugin.js.html", "openhcs_panel"]'

# Expose port
EXPOSE 4080

